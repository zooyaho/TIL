# ì‚¬ìš©ì ë¡œê·¸ì¸
- `setQueryData`: ì‹¤ì œë¡œ ìºì‹œì— ë°ì´í„°ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•¨
- `removeQuries`: ìºì‹œì—ì„œ ì¿¼ë¦¬ë¥¼ ì‚­ì œí•˜ê¸° ìœ„í•¨

## â­ï¸ JWT(JASON Web Token)
- ì¸ì¦ í† í°
- **JWTëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì‚¬ìš©ì ëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³´ë‚´ê³  ì´ê²ƒì´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¼ì¹˜í•œë‹¤ë©´ ì„œë²„ê°€ í† í°ì„ ë³´ë‚´ëŠ” ë°©ì‹ìœ¼ë¡œ ì‘ë™í•œë‹¤!**
- ì–¸ì œë“  í´ë¼ì´ì–¸íŠ¸ê°€ í•„ìš”ë¡œ í•˜ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ëŠ” í—¤ë”ì˜ í† í°ì„ ìš”ì²­ê³¼ í•¨ê»˜ ë³´ë‚¸ë‹¤. ê·¸ëŸ¬ë©´ ì„œë²„ê°€ ì´ í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ì¦ ëìŒì„ ì¸ì§€í•œë‹¤.

### ğŸ” ë³´ì•ˆ
- `ì„œë²„`ê°€ í† í°ì„ ìƒì„±í•˜ê³  ì‚¬ìš©ì ëª…, ì‚¬ìš©ì IDì™€ ê°™ì€ ì •ë³´ë¥¼ ì¸ì½”ë”©í•œë‹¤.
- ì¸ì½”ë”© ëœ í† í°ì´ ì„œë²„ë¡œ ëŒë ¤ ë³´ë‚´ì§€ë©´ ë””ì½”ë”©ì´ ë˜ê³  ë°ì´í„°ê°€ ì¼ì¹˜í•¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ ì„œë²„ë¥¼ ì„¤ì¹˜í•  ë•Œ ì•”í˜¸ê°€ í•„ìš”í•œ ê²ƒì´ë‹¤.
- í† í°ì„ ì¸ì½”ë”©, ë””ì½”ë”©í•˜ëŠ” ë° ê·¸ ì•”í˜¸ê°€ í•„ìš”í•œ ê²ƒì´ë‹¤.

âœ”ï¸ ì˜ˆì œì—ì„œì˜ ë³´ì•ˆ
- ì´ ì˜ˆì œì—ì„œëŠ” í† í°ì´ ì‚¬ìš©ê°€ ê°ì²´ì— ì €ì¥ë˜ì–´ ìˆë‹¤.
- ì„œë²„ë¡œë¶€í„° ì „ë‹¬ëœ ì‚¬ìš©ì ê°ì²´ê°€ ì´ í† í°ì„ ë‹´ê³  ìˆê³  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©í–ˆë“¯ì´ ì´ ì‚¬ìš©ì ê°ì²´ë„ í† í°ì„ ë‹´ê³  ìˆë‹¤.
- ì´ ì˜ˆì œëŠ” localStorageì— í† í°ì„ ìœ ì§€í•œë‹¤. ê·¸ë˜ì„œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ì„ í•˜ë”ë¼ë„ ì‚¬ìš©ìê°€ ë¡œê·¸ì•„ì›ƒì´ ë˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.

## ğŸ§ ëˆ„ê°€ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì†Œìœ í•´ì•¼í• ê¹Œ?
- React Queryì˜ ì±…ì„ì€ í´ë¼ì´ì–¸íŠ¸ì˜ ì„œë²„ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ë‹¤.
- useAuth í›…ì˜ ì±…ì„ì€ signIn, signUp, signOut í•¨ìˆ˜ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì´ë‹¤. ê·¸ë˜ì„œ ì„œë²„ì— ìˆëŠ” ì‚¬ìš©ìë¥¼ ì¸ì¦í•  ìˆ˜ ìˆëŠ”ê²ƒì´ë‹¤.
- ê²°ë¡ ì€ ë°ì´í„° ì €ì¥ì€ React Queryì— í•˜ëŠ”ê²Œ ë§ë‹¤! ê·¸ëŸ¬ë ¤ë©´ useUserë¼ëŠ” í›…ì´ í•„ìš”í•œ ê²ƒì´ë‹¤!!!
- React QueryëŠ” ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  useAuthëŠ” ì§€ì›ì„ í•œë‹¤. ì„œë²„ë¥¼ í˜¸ì¶œí•  ë•Œ useAuthëŠ” ì‚¬ìš©ì ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•œë‹¤.
- ì„œë²„ëŠ” useAuthì˜ signIn, signUp í˜¸ì¶œ ì‹œ ë°ì´í„°ë¥¼ ë°˜í™˜í•œë‹¤!
- useUserì˜ í•¨ìˆ˜ë¡œ ì´ëŸ° ë‚´ìš©ì„ ìºì‹œì— ì¶”ê°€í•˜ë©´ ëœë‹¤.

### ğŸ” useUser í›…ì˜ ì—­í• 
- ì¿¼ë¦¬ ìºì‹œì— ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— useUserì€ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë°˜í™˜í•´ì•¼í•œë‹¤.(ê°ì²´ ë°˜í™˜)
- localStorageì˜ ë°ì´í„°ë¥¼ ë¡œë”©í•´ì„œ ì´ˆê¸° ì„¤ì •ì„ í•œë‹¤. -> ì‚¬ìš©ìê°€ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ë„ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ëŠ” ë°©ë²•ì´ë‹¤.
- useQuery ì¸ìŠ¤í„´ìŠ¤ì˜ ì¿¼ë¦¬ í•¨ìˆ˜ëŠ” ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìì˜ IDì™€ í•¨ê»˜ ì„œë²„ì— ìš”ì²­ì„ ë³´ë‚¸ë‹¤. ê·¸ëŸ¼ ì„œë²„ê°€ ê·¸ ì‚¬ìš©ìì— ê´€í•œ ë°ì´í„°ë¥¼ ëŒë ¤ë³´ë‚´ ì¤€ë‹¤. ë§Œì•½ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ì—†ë‹¤ë©´ ì¿¼ë¦¬ í•¨ìˆ˜ëŠ” nullë¥¼ ë°˜í™˜í•  ê²ƒì´ë‹¤.
- useUserì˜ ì—­í• ì€ ìš°ë¦¬ ì•±ì˜ íŠ¹ì • ì¸ìŠ¤í„´ìŠ¤ê¹Œì§€ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë¥¼ ì¶”ì í•˜ëŠ” ê²ƒì´ë‹¤.
- ì •ë³´ê°€ ì—…ë°ì´íŠ¸ ë˜ë©´ setQueryDataë¡œ ì§ì ‘ React Query ìºì‹œë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤. ê·¸ë¦¬ê³  localStorageë„ ì—…ë°ì´íŠ¸ í•œë‹¤.
- localStorage ì—…ë°ì´íŠ¸ëŠ” onSuccess ì½œë°±ì—ì„œ ì§„í–‰ë˜ë©° useQueryê¹Œì§€ ì—…ë°ì´íŠ¸ í•œë‹¤.
- onSuccess ì½œë°±ì€ setQueryDataì™€ ì¿¼ë¦¬ í•¨ìˆ˜ê°€ ì‹¤í–‰ëœ ì´í›„ì— ì‹¤í–‰ëœë‹¤.
- ì–´ë–¤ ë°©ì‹ìœ¼ë¡œë“  ì¿¼ë¦¬ ìºì‹œëŠ” ì—…ë°ì´íŠ¸ ë˜ëŠ”ë° setQueryDataë¥¼ í†µí•´ ì—…ë°ì´íŠ¸ê°€ ë˜ê±°ë‚˜ ì¿¼ë¦¬ í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ë•Œ ìƒê¸´ ë³€ì´ ë’¤ì— ì—…ë°ì´íŠ¸ ë  ìˆ˜ë„ ìˆë‹¤.
- ì–´ë–¤ ë°©ë²•ì´ë“  onSuccess ì½œë°±ì€ localStorageë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤.

### ğŸ§ ì‚¬ìš©ì ë°ì´í„°ë¥¼ Auth Providerì— ì €ì¥í•  ìˆ˜ëŠ” ì—†ì„ê¹Œ?
- ì˜µì…˜ìœ¼ë¡œ ê°€ëŠ¥í•˜ë‹¤.
- ë‹¨ì ìœ¼ë¡œëŠ” ì´ë¯¸ ë³µì¡í•œ ì‹œìŠ¤í…œì— ë³µì¡í•¨ì„ ë”í•œë‹¤ëŠ” ê²ƒì´ë‹¤.
- ë¶ˆí•„ìš”í•œ ë°ì´í„°ê°€ ìƒê¸´ë‹¤ëŠ” ê²ƒë„ ë‹¨ì ì´ë‹¤. ì‚¬ìš©ì ë³€ì´ë¥¼ í—ˆìš©í•œë‹¤ë©´ ê·¸ ì‚¬ìš©ì ë°ì´í„°ë¥¼ React Queryì— ë³´ê´€ í•˜ê³  ì‹¶ì„ ë•Œ, Auth Providerì—ë„ ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì…ë ¥í•´ì•¼ í•œë‹¤.

### ğŸ” useAuthí›…ì˜ ì—­í• 
- useAuthì˜ ì—­í• ì€ signin, signup, signout í•¨ìˆ˜ë“¤ì´ ì„œë²„ì™€ í†µì‹ í•˜ë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤
- ì¿¼ë¦¬ ìºì‹œì— ê°’ì„ ì„¤ì •í•œë‹¤
- React QueryëŠ” ì¸ì¦ ì œê³µì ì—­í• ì„ í•˜ë©° React Query cacheëŠ” userê°’ì„ í•„ìš”ë¡œí•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì— userê°’ì„ ì œê³µí•œë‹¤.
- ì¿¼ë¦¬ ìºì‹œì— ê°’ì„ ì„¤ì •í•˜ê¸° ìœ„í•´ `queryClient.setQueryData`ë¥¼ ì‚¬ìš©í•œë‹¤. ì¿¼ë¦¬ í‚¤ì™€ ê°’ì„ ê°€ì ¸ì™€ ì¿¼ë¦¬ìºì‹œì— í•´ë‹¹ í‚¤ì— ëŒ€í•œ ê°’ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
- useUserí›…ì˜ updateUser, clearUserì—`queryClient.setQueryData`ë¥¼ ì‘ì„±í•˜ê³ , useAuthì—ì„œëŠ” ì´ í•¨ìˆ˜ë“¤ì„ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©í•œë‹¤!

## â— setQueryData
- QueryClientì˜ ë©”ì„œë“œì´ë‹¤.

```js
// useUser.tsx
const queryClient = useQueryClient();

// meant to be called from useAuth.tsx
function updateUser(newUser: User): void {
  // ì‚¬ìš©ì ë¡œê·¸ì¸ì´ë‚˜, ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸ë¥¼ ì²˜ë¦¬
  queryClient.setQueryData(queryKeys.user, newUser); // onSuccessë¥¼ íŠ¸ë¦¬ê±°í•œë‹¤.
}

// meant to be called from useAuth.tsx
function clearUser() {
  // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
  queryClient.setQueryData(queryKeys.user, null); // onSuccessë¥¼ íŠ¸ë¦¬ê±°í•œë‹¤.
}
```

## ë¡œê·¸ì¸ ìœ ì§€í•˜ê¸°
- ìƒˆë¡œê³ ì¹¨í•´ë„ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ localStorageì— ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.
- **useUserì˜ useQueryê°€ ì´ˆê¸° ì‹¤í–‰ë  ë•Œ í•´ë‹¹ localStorageë¥¼ ì´ˆê¸° ë°ì´í„°ë¡œ ì‚¬ìš©í•œë‹¤!!**
- ì´ˆê¸° ì‹¤í–‰ ì‹œ localStorageì—ì„œ ë¡œë“œí•˜ì—¬ í˜ì´ì§€ë¥¼ ìƒˆë¡œ ê³ ì¹¨í•´ë„ React Queryê°€ ì‚¬ìš©ìë¥¼ ìƒì§€ ì•Šë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤.
- ì• ì´ˆì— localStorageê°€ ì‚¬ìš©ì ë°ì´í„°ë¡œ ì±„ì›Œì ¸ ìˆì–´ì•¼ localStorageì—ì„œ ë¡œë“œí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë¯€ë¡œ useQueryì˜ onSuccess ì½œë°±ìœ¼ë¡œ localStorageë¥¼ ì—…ë°ì´íŠ¸ í•´ì•¼í•œë‹¤.
- onSuccess ì½œë°±ì€ useAuth í•¨ìˆ˜ ì‘ì—… ì‹œ ì‚¬ìš©í•˜ëŠ” queryClient.setQueryData ì‹¤í–‰ ì´í›„ë‚˜ ì¿¼ë¦¬í•¨ìˆ˜ê°€ ë°˜í™˜ëœ í›„ì— ì‹¤í–‰ëœë‹¤.

### â— onSuccess ì˜µì…˜
- useQueryì˜ ì˜µì…˜
- onSuccessëŠ” ì¿¼ë¦¬ í•¨ìˆ˜ë‚˜ setQueryDataì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ì´ë‹¤.(ë‘˜ ë‹¤ì—ì„œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì´ë‹¤)

```js
// ê¸°ì¡´ userì˜ ê°’ì„ ì´ìš©í•´ì„œ userì˜ ê°’ì„ ì—…ë°ì´íŠ¸í•œë‹¤.
const { data: user } = useQuery(queryKeys.user, () => getUser(user), {
    // updateUserì™€ clearUserì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ë©´ ê°ê° Userì™€ nullì„ ê°€ì ¸ì˜¤ë¯€ë¡œ í•´ë‹¹ íƒ€ì… ì„¤ì •
    onSuccess: (received: User | null) => {
      if (!received) {
        // localStorage.removeItem(USER_LOCALSTORAGE_KEY);
        clearStoredUser();
      } else {
        // localStorage.setItem(USER_LOCALSTORAGE_KEY, JSON.stringify(user));
        setStoredUser(received);
      }
    },
});
```

ğŸš¨ [ë¬¸ì œ] ìœ„ì™€ ê°™ì´ ì‘ì„±í•  ê²½ìš° ìƒˆë¡œê³ ì¹¨í•´ë„ ë¡œê·¸ì¸ ìƒíƒœê°€ ìœ ì§€ ë˜ì§€ ì•ŠëŠ”ë‹¤
ğŸ’¡ [í•´ê²°] ì‚¬ìš©ì ë°ì´í„°ê°€ localStorageì— ì •ì˜ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•´ì•¼í•œë‹¤ -> initailDataì˜µì…˜ì„ ì‚¬ìš©í•œë‹¤.

### â— initailData ì˜µì…˜
- useQueryì˜ ì˜µì…˜
- ì´ˆê¸° ë°ì´í„°ë¥¼ ìºì‹œì— ì¶”ê°€í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•œë‹¤.
- fallback, placeholderDataì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ ì´ ë‘˜ì€ ìºì‹œì— ì¶”ê°€ë˜ì§€ ì•ŠëŠ”ë‹¤!!!
- í•˜ì§€ë§Œ ì‚¬ìš©ìì˜ ê²½ìš° ìºì‹œì— ì¶”ê°€í•´ì•¼í•œë‹¤!

```js
 // ê¸°ì¡´ userì˜ ê°’ì„ ì´ìš©í•´ì„œ userì˜ ê°’ì„ ì—…ë°ì´íŠ¸í•œë‹¤.
const { data: user } = useQuery(queryKeys.user, () => getUser(user), {
    // const storedUser = localStorage.getItem(USER_LOCALSTORAGE_KEY);
    // return storedUser ? JSON.parse(storedUser) : null;
    initialData: getStoredUser,
    onSuccess: (received: User | null) => {
      if (!received) {
        clearStoredUser();
      } else {
        setStoredUser(received);
      }
    },
});
```

## â— removeQuries
- ë¡œê·¸ì•„ì›ƒ ì‹œ ì‚¬ìš©ì ì˜ˆì•½ ì¿¼ë¦¬ ì‚­ì œí•˜ê¸°
- queryClient ë©”ì„œë“œ
- íŠ¹ì • ì¿¼ë¦¬ì— ëŒ€í•œ ë°ì´í„°ë¥¼ ì œê±°í•œë‹¤.

### ğŸ§ userë°ì´í„°ì— removeQuriesë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  setQueryDataì— nullì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ?
- ì‚¬ìš©ì ë°ì´í„°ë¥¼ ë³€ê²½í•´ì„œ onSuccess ì½œë°±ì„ ë°œìƒì‹œí‚¬ ë•Œ onSuccessì½œë°±ì´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„°ë¥¼ ìœ ì§€í•˜ë©° setQueryDataê°€ onSuccessë¥¼ ë°œìƒì‹œí‚¤ê¸° ë•Œë¬¸ì´ë‹¤.
- **removeQuriesê°€ ì‹¤í–‰í•˜ê³  onSuccessê°€ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤!!!**
- userAppointmentsëŠ” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ useUserì— onSuccessë¥¼ í•„ìš”í•˜ì§€ ì•Šë‹¤

```js
// useUser.tsx
function clearUser() {
    // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
    queryClient.setQueryData(queryKeys.user, null); // onSuccessë¥¼ íŠ¸ë¦¬ê±°í•œë‹¤.
    queryClient.removeQueries('user-appointments');
}
```
ğŸ‘‰ğŸ» í•˜ë‚˜ ì´ìƒì˜ ì¿¼ë¦¬í‚¤ì— removeQueriesë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ removeQueriesë¥¼ ì—¬ëŸ¬ë²ˆ ë™ì¼í•˜ê²Œ ì‹¤í–‰í•˜ë©´ ëœë‹¤.